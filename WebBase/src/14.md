# Js内存泄露

### 垃圾回收GC
- 引用计数（以前）

    ```js
      // 对象被 a 引用
      const a = { x: 100 }
      let a1 = a
      a = 10
      a1 = null

      // 循环引用 (导致无法回收)
      function fn() {
        const obj1 = {}
        const obj2 = {}
        obj1.a = obj2
        obj2.a = obj1
      }

      fn()

      // IE6-7 内存泄露的 bug
      var div1 = document.getElementById("div1")
      div1.a = div1
      div1.b = {}
    ```
- 标记清除（现代）

      标记清除的垃圾回收跟踪了由根（`window`）访问的所有对象，所以在有循环引用的情况下也能正确的标记，并且执行垃圾回收工作。

      标记清除的缺点是，当垃圾回收算法执行时，正常的程序会被挂起，特别是程序是一个交互式程序，或者正在有一些实时运算时，就会成为一个缺点，比如一个正在进行的交互式程序会周期性的无响应。

      !> `JavaScript` 具有自动垃圾收集机制，执行环境会负责管理代码执行过程中使用的内存。也就是说，所需内存的分配和无用内存的回收完全实现了自动管理。


### 闭包
闭包一般指可以访问另一个函数作用域中变量的函数。

### 闭包是内存泄漏吗？

闭包不是内存泄漏，内存泄露一般指我们的代码出现非预期的情况，闭包只是不可以被垃圾回收。

### 怎么检测内存泄露？
我们可以通过检测内存变化来观察是否出现内存泄露，如果内存一直升高不下降，那么就很有可能是程序出现了内存泄露。

内存出现升高下降是正常现象，并不是出现了内存泄露。

### 内存泄露的一些场景

- vue
  ```markup
    1. 全局变量、函数引用，组件销毁时未清除
    2. 全局事件、定时器引用，组件销毁时未清除
    3. 自定义事件引用，组件销毁时未清除
  ```
